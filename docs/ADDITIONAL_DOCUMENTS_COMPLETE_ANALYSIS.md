# üìÑ Additional Documents - Complete Data Source Analysis

**Date:** 2025-01-XX  
**Purpose:** Explain where additional documents' structure, content, and format come from

---

## üéØ Quick Answer

**Additional documents come from THREE different sources** that are merged together:
1. **Hardcoded templates** with full markdown content (`additionalDocuments.ts`)
2. **Static document bundles** with document IDs (`documentBundles.ts` + `documentDescriptions.ts`)
3. **Program-specific documents** from database (`categorizedRequirements.documents`)

---

## üìÇ Document System Architecture

### System Overview:

```
Additional Documents System
‚îú‚îÄ‚îÄ 1. ADDITIONAL_DOCUMENTS (Hardcoded Templates)
‚îÇ   ‚îî‚îÄ‚îÄ Full markdown templates with instructions
‚îú‚îÄ‚îÄ 2. documentBundles (Static Document Lists)
‚îÇ   ‚îú‚îÄ‚îÄ Maps product+funding ‚Üí document IDs
‚îÇ   ‚îî‚îÄ‚îÄ References documentDescriptions.ts
‚îî‚îÄ‚îÄ 3. Program Documents (Database)
    ‚îî‚îÄ‚îÄ From categorizedRequirements.documents
```

---

## 1Ô∏è‚É£ Hardcoded Templates (`ADDITIONAL_DOCUMENTS`)

### Location:
`features/editor/templates/additionalDocuments.ts`

### Source Comment:
```typescript
// Based on GPT agent comprehensive instructions
```

**This means:** These were originally generated by GPT, then hardcoded into the file.

### What's Inside:

**Full Structure:**
```typescript
export const ADDITIONAL_DOCUMENTS = {
  grants: {
    submission: [
      {
        id: 'work_plan_gantt',
        name: 'Work Plan & Gantt Chart',
        description: 'Timeline and milestones...',
        required: true,
        format: 'xlsx',
        maxSize: '10MB',
        template: `# Work Plan & Gantt Chart Template    // ‚Üê FULL MARKDOWN TEMPLATE
## Project Overview
- Project Title: [Project Name]
...
## Work Packages
| WP | Title | Description | ...
|----|-------|-------------|-----|
...`,  // Complete markdown template structure
        instructions: [                         // ‚Üê Step-by-step guide
          'Define clear work packages...',
          'Set realistic timelines...',
          'Assign lead partners...'
        ],
        examples: [                             // ‚Üê Example references
          'Horizon Europe work plan example',
          'EIC Accelerator Gantt chart',
          'FFG Basisprogramm timeline'
        ],
        commonMistakes: [                       // ‚Üê Pitfalls to avoid
          'Unrealistic timelines...',
          'Vague work package descriptions...'
        ]
      },
      // ... more documents
    ]
  },
  // ... bankLoans, equity, visa
}
```

### Content Source:
- **Originally:** Generated by GPT agent based on "comprehensive instructions"
- **Now:** Hardcoded in TypeScript file
- **Includes:** Full markdown templates, instructions, examples, common mistakes
- **Organized by:** Funding type ‚Üí Product type

### Documents Available:

**Grants + Submission:**
- Work Plan & Gantt Chart (xlsx)
- Budget Breakdown & Financial Model (xlsx)
- Ethics & Risk Assessment (pdf)

**BankLoans + Submission:**
- Business Plan (Bank Format) (docx)
- Collateral Documentation (pdf)

**Equity + Submission:**
- Pitch Deck (pptx)
- Cap Table (xlsx)

**Visa + Submission:**
- Job Creation Plan (pdf)
- Proof of Funds (pdf)

**Total:** 8 document templates with full content

---

## 2Ô∏è‚É£ Static Document Bundles (`documentBundles`)

### Location:
`shared/data/documentBundles.ts`

### Source Comment:
```typescript
// Now uses BASIS PACK as single source of truth
```

### What It Is:
A **mapping system** that lists which documents are needed for each product+funding combination.

### Structure:
```typescript
export const documentBundles: Record<Product, Record<FundingType, DocumentBundle>> = {
  submission: {
    grants: {
      product: 'submission',
      fundingType: 'grants',
      documents: [
        'businessPlan',              // ‚Üê Document IDs
        'workPlanGantt',
        'budgetSheet',
        'founderCV',
        'annexGuidance'
      ],
      description: '5-6 documents: Full business plan, work plan & Gantt, ...',
      i18nKey: 'bundles.submission.grants'
    },
    bankLoans: {
      documents: [
        'businessPlan',
        'financialModel3to5y',
        'bankSummaryOnePager',
        'amortizationSchedule',
        'collateralSheet'
      ],
      // ...
    },
    // ... equity, visa
  },
  strategy: { ... },
  review: { ... }
}
```

### Document Details:
Document IDs reference `documentDescriptions.ts` for:
- Title
- Short description
- Format hints
- Detailed descriptions

---

## 3Ô∏è‚É£ Document Descriptions (`documentDescriptions.ts`)

### Location:
`shared/data/documentDescriptions.ts`

### What It Is:
A **registry** of all document IDs with their metadata.

### Structure:
```typescript
export interface DocumentDescription {
  id: string;
  title: string;
  short: string;
  formatHints: string[];      // ['PDF', 'DOCX', 'XLSX']
  description: string;         // Full description
  // ...
}

export const documentDescriptions: Record<string, DocumentDescription> = {
  businessPlan: {
    id: 'businessPlan',
    title: 'Business Plan',
    short: 'Comprehensive business plan document',
    formatHints: ['PDF', 'DOCX'],
    description: 'Full business plan with all sections...',
    // ...
  },
  workPlanGantt: {
    id: 'workPlanGantt',
    title: 'Work Plan & Gantt Chart',
    short: 'Project timeline with work packages',
    formatHints: ['XLSX', 'PDF'],
    // ...
  },
  // ... all document IDs
}
```

### Source:
- **Hardcoded** document registry
- Provides metadata for document IDs used in bundles

---

## 4Ô∏è‚É£ Program-Specific Documents (Database)

### Location:
`pages/api/programmes/[id]/requirements.ts` ‚Üí `buildAdditionalDocuments()`

### What It Is:
Documents extracted from scraped program pages.

### Source:
From `categorizedRequirements.documents` category in database:
```typescript
// From database requirements table
{
  category: 'documents',
  type: 'required',
  value: 'Financial Statement',
  format: 'PDF',
  description: 'Last 3 years of financial statements',
  required: true
}
```

### How It Works:
```typescript
function buildAdditionalDocuments(program, categorizedRequirements) {
  // 1. Get static bundle documents
  const bundle = getDocumentBundle(product, fundingType);
  const staticDocs = bundle.documents.map(docId => {
    const spec = getDocumentById(docId);  // From documentDescriptions.ts
    return {
      id: docId,
      title: spec?.title || docId,
      description: spec?.short || '',
      format: spec?.formatHints[0] || 'PDF',
      source: 'bundle'  // ‚Üê Static source
    };
  });

  // 2. Get program-specific documents
  const programDocs = categorizedRequirements?.documents_required
    ? categorizedRequirements.documents_required.map(d => ({
        id: d.id || `prog_doc_${idx}`,
        title: d.title || 'Required Document',
        description: d.description || d.note || '',
        format: d.format || 'PDF',
        source: 'program'  // ‚Üê Database source
      }))
    : [];

  // 3. Merge and dedupe
  return [...programDocs, ...staticDocs];
}
```

---

## üîÑ How Documents Are Merged

### When User Selects a Program:

```
1. API: /api/programmes/[id]/requirements
   ‚Üì
2. Get categorizedRequirements from database
   ‚Üì
3. buildAdditionalDocuments() called
   ‚Üì
4. Merge:
   a) Static bundle documents (documentBundles.ts)
      ‚Üí References documentDescriptions.ts for details
   b) Program-specific documents (database)
      ‚Üí From categorizedRequirements.documents
   ‚Üì
5. Return merged list
```

### When User Doesn't Select a Program:

```
1. Use template fallback
   ‚Üì
2. getDocumentBundle(product, fundingType)
   ‚Üì
3. Get static documents from documentBundles.ts
   ‚Üì
4. No program documents (empty)
   ‚Üì
5. Return static bundle only
```

---

## üìä Complete Document Flow

### System 1: ADDITIONAL_DOCUMENTS (Templates)
- **Location:** `features/editor/templates/additionalDocuments.ts`
- **Content:** Full markdown templates, instructions, examples
- **Source:** Originally GPT-generated, now hardcoded
- **Used for:** Template structure when creating documents
- **Status:** ‚úÖ Complete (8 document templates)

### System 2: documentBundles (Static Lists)
- **Location:** `shared/data/documentBundles.ts`
- **Content:** Document ID mappings by product+funding
- **Source:** Hardcoded based on BASIS PACK
- **Used for:** Determining which documents are needed
- **Status:** ‚úÖ Complete (all product+funding combinations)

### System 3: documentDescriptions (Metadata)
- **Location:** `shared/data/documentDescriptions.ts`
- **Content:** Title, description, format for each document ID
- **Source:** Hardcoded registry
- **Used for:** Getting document details for bundle IDs
- **Status:** ‚úÖ Complete (all document IDs have metadata)

### System 4: Database Documents (Program-Specific)
- **Location:** Database `requirements` table, category='documents'
- **Content:** Documents extracted from program pages
- **Source:** Scraper extracts from HTML
- **Used for:** Program-specific required documents
- **Status:** ‚úÖ Working (extracted from real programs)

---

## ‚ùì Where Does Content Come From?

### Template Content (ADDITIONAL_DOCUMENTS):
- **Structure:** Markdown tables, sections, placeholders `[Project Name]`
- **Source:** Originally GPT-generated based on instructions
- **Now:** Hardcoded in `additionalDocuments.ts`
- **Example:**
  ```markdown
  ## Work Packages
  | WP | Title | Description | Start | End | Duration | Lead | Partners |
  |----|-------|-------------|-------|-----|----------|------|----------|
  | WP1 | [Title] | [Description] | [Date] | [Date] | [Months] | [Lead] | [Partners] |
  ```

### Instructions & Examples:
- **Instructions:** Step-by-step creation guidance
- **Examples:** Reference names like "Horizon Europe work plan example"
- **Common Mistakes:** Pitfalls to avoid
- **Source:** All hardcoded in `additionalDocuments.ts`

### Document Metadata:
- **Titles:** Hardcoded in `documentDescriptions.ts`
- **Descriptions:** Hardcoded in `documentDescriptions.ts`
- **Formats:** Hardcoded arrays: `['PDF', 'DOCX', 'XLSX']`

### Program-Specific Documents:
- **Content:** Extracted from program HTML pages by scraper
- **Structure:** Parsed from program requirement sections
- **Source:** Real program websites ‚Üí Database ‚Üí API

---

## ‚ö†Ô∏è Current Issues

### Issue 1: Two Different Systems
- `ADDITIONAL_DOCUMENTS` has full templates but isn't used in API
- `documentBundles` is used but only has IDs, not full templates
- **Result:** Templates exist but may not be accessible in editor

### Issue 2: Templates Not Connected to Editor
- `ADDITIONAL_DOCUMENTS` defines templates but:
  - Not referenced in `buildAdditionalDocuments()`
  - Not used in editor UI
  - May be legacy/unused code

### Issue 3: No Template Rendering
- Templates are markdown strings but:
  - No template engine to fill placeholders
  - No way to generate actual documents from templates
  - Templates are just reference material

---

## üìù Summary: Where Everything Comes From

| Element | Source | Location | Status |
|---------|--------|----------|--------|
| **Template Structure** | Hardcoded markdown | `additionalDocuments.ts` | ‚úÖ Complete |
| **Template Content** | GPT-generated, hardcoded | `additionalDocuments.ts` | ‚úÖ Complete |
| **Instructions** | Hardcoded arrays | `additionalDocuments.ts` | ‚úÖ Complete |
| **Examples** | Hardcoded arrays | `additionalDocuments.ts` | ‚úÖ Complete |
| **Document Bundles** | Hardcoded mapping | `documentBundles.ts` | ‚úÖ Complete |
| **Document Metadata** | Hardcoded registry | `documentDescriptions.ts` | ‚úÖ Complete |
| **Program Documents** | Database (scraper) | `requirements` table | ‚úÖ Working |
| **Merging Logic** | Hardcoded function | `buildAdditionalDocuments()` | ‚úÖ Working |
| **Template Usage** | ‚ùì Unknown | Not connected | ‚ö†Ô∏è Needs verification |

---

## üîç Key Findings

1. **ADDITIONAL_DOCUMENTS** exists with full templates but may not be used
2. **documentBundles** is actively used in API
3. **Templates are markdown strings** - no rendering engine
4. **Content was GPT-generated** - now hardcoded
5. **Program documents enhance** static bundles from database
6. **Two parallel systems** that may need integration

---

## ‚úÖ Recommendations

1. **Verify Template Usage:** Check if `ADDITIONAL_DOCUMENTS` is used anywhere
2. **Connect Templates:** Integrate `ADDITIONAL_DOCUMENTS` with editor UI
3. **Template Engine:** Add ability to render templates with user data
4. **Unify Systems:** Merge `ADDITIONAL_DOCUMENTS` and `documentBundles` into one system
5. **Documentation:** Document which system is primary

**Status:** Templates exist but connection to editor needs verification.

